plugins {
    alias(libs.plugins.neoforge)
    alias(libs.plugins.neoforgeMixin)
}

mixin {
    config '${modId}.neoforge.mixins.json'
}

minecraft {
    mappings {
        channel = official()
        version.put "minecraft", libs.versions.minecraftVersion.get()
    }
}

runs {
    configureEach {
        systemProperty "forge.logging.markers", "REGISTRIES"
        systemProperty "forge.logging.console.level", "debug"

        modSource project.sourceSets.main
    }

    client {
//        named("runFTForgeClient")
        workingDirectory project.file("./run/client")
    }

    server {
//        named("runFTForgeServer")
        workingDirectory project.file("./run/server")
        programArguments.addAll "--nogui"
    }

    gameTestServer {
//        named("runFTForgeTestServer")
        systemProperty 'forge.enabledGameTestNamespaces', 'fallingtree'
        workingDirectory project.file("./run/test")
    }

    data {
//        named("runFTForgeData")
        workingDirectory project.file("./run/data")
        programArguments.addAll '--mod', 'fallingtree', '--all', '--output', file('src/generated/resources/').getAbsolutePath(), '--existing', file('src/main/resources/').getAbsolutePath()
    }
}

configurations {
    library
    implementation.extendsFrom library
}

//minecraft.runs.all {
//    lazyToken('minecraft_classpath') {
//        configurations.library.copyRecursive().resolve().collect { it.absolutePath }.join(File.pathSeparator)
//    }
//}

sourceSets.main.resources { srcDir 'src/generated/resources' }

dependencies {
    implementation(libs.neoforge)
    library(project(":common"))

    implementation(libs.clothConfigNeoforge)
}

processResources {
    duplicatesStrategy = DuplicatesStrategy.INCLUDE

    from "src/main/resources", "../common/src/main/resources"

    var replaceProperties = [
            minecraftVersion: libs.versions.minecraftVersion.get()
    ]

    filesMatching(["META-INF/mods.toml", "pack.mcmeta"]) {
        expand replaceProperties + project.properties
    }
}
